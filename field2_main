import os
import json
import re
from pathlib import Path

# ğŸ”¹ Input folders (adjust if needed)
sentence_dir = Path(r"C:\Users\HariharaM12\PycharmProjects\New_project\output\sentences")
field_dir = Path(r"C:\Users\HariharaM12\PycharmProjects\New_project\output\fields")

# ğŸ”¹ Output files
performance_output_path = Path(r"C:\Users\HariharaM12\PycharmProjects\New_project\output\performance_status_output.json")
mutation_output_path = Path(r"C:\Users\HariharaM12\PycharmProjects\New_project\output\mutational_status_output.json")

# ğŸ”¹ Output lists
performance_status_output = []
mutational_status_output = []

# ğŸ”¹ Clean filename helper
def sanitize_filename(name: str) -> str:
    return re.sub(r'[\\/*?:"<>|]', "_", name)

# ğŸ” Process each field file
for field_file in field_dir.glob("*.json"):
    try:
        with open(field_file, "r", encoding="utf-8") as f:
            field_data = json.load(f)

        document_title = field_data.get("document_title", field_file.stem)
        sentence_file = sentence_dir / f"{sanitize_filename(document_title)}.json"

        if not sentence_file.exists():
            print(f"âš ï¸ Sentence file not found: {sentence_file}")
            continue

        with open(sentence_file, "r", encoding="utf-8") as f:
            sentence_data = json.load(f)

        # âœ… Extract performance_status block
        performance_status_output.append({
            "document_title": document_title,
            "performance_status": field_data.get("performance_status", {})
        })

        # âœ… Extract mutational_status block
        mutational_status_output.append({
            "document_title": document_title,
            "mutational_status": field_data.get("mutational_status", {})
        })

    except Exception as e:
        print(f"âŒ Error processing {field_file.name}: {e}")

# ğŸ’¾ Save output files
with open(performance_output_path, "w", encoding="utf-8") as f:
    json.dump(performance_status_output, f, indent=4)

with open(mutation_output_path, "w", encoding="utf-8") as f:
    json.dump(mutational_status_output, f, indent=4)

print(f"âœ… Saved: {performance_output_path}")
print(f"âœ… Saved: {mutation_output_path}")
